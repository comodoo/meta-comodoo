This README file contains information on the contents of the
comodoo layer.

Please see the corresponding sections below for details.


Dependencies
============

This layer depends on:

  URI: git://git.openembedded.org/bitbake
  branch: krogoth

  URI: git://git.openembedded.org/openembedded-core
  layers: meta
  branch: krogoth

  URI: git://git.openembedded.org/meta-openembedded
  layers: meta-oe, meta-gnome
  branch: krogoth

  URI: git://github.com/mozilla-japan/meta-browser.git
  branch: firefox-45.0esr


Table of Contents
=================

  I. Adding the comodoo layer to your build
  II. Build Configuration for RaspberryPi 3
  III. Framebuffer in RaspberryPi

I. Adding the comodoo layer to your build
=================================================

In order to use this layer, you need to make the build system aware of
it.

Assuming the comodoo layer exists at the top-level of your
yocto build tree, you can add it to the build system by adding the
location of the comodoo layer to bblayers.conf, along with any
other layers needed. e.g.:

BBLAYERS ?= " \
    /path/to/yocto/meta \
    /path/to/yocto/meta-poky \
    /path/to/yocto/meta-yocto-bsp \
    /path/to/yocto/meta-openembedded/meta-oe \
    /path/to/yocto/meta-openembedded/meta-gnome \
    /path/to/yocto/meta-browser \
    /path/to/yocto/meta-comodoo \
  "

Now, let see with some more detail how to build the comodoo image
for a Raspberry Pi 3:

1. [OPTIONAL] sudo apt-get install autoconf2.13
2. git clone git://git.yoctoproject.org/poky
   cd poky/
   git checkout -b krogoth origin/krogoth
3. git clone git://git.yoctoproject.org/meta-raspberrypi
   # No need to checkout another branch, only master branch has raspberrypi3.conf
4. git clone git://git.openembedded.org/meta-openembedded
   cd meta-openembedded/
   git checkout -b krogoth origin/krogoth
   cd ..
5. git clone git://github.com/mozilla-japan/meta-browser.git
   # Default brach is already firefox-45.0esr
6. git clone git://github.com/indisoluble/meta-comodoo.git
   # Or git clone git@github.com:indisoluble/meta-comodoo.git
7. source oe-init-build-env
8. cd conf/
9.nano bblayers.conf
   # Edit var BBLAYERS as follows:
BBLAYERS ?= " ng 
    /path/to/yocto/meta \
    /path/to/yocto/meta-poky \
    /path/to/yocto/meta-yocto-bsp \
    /path/to/yocto/meta-raspberrypi \
    /path/to/yocto/meta-openembedded/meta-oe \
    /path/to/yocto/meta-openembedded/meta-gnome \
    /path/to/yocto/meta-browser \
    /path/to/yocto/meta-comodoo \
  "
10. nano local.conf
   # Add following line to the end of the file:
MACHINE ?= "raspberrypi3"

PREFERRED_PROVIDER_virtual/libgl = "mesa"
PREFERRED_PROVIDER_virtual/libgles2 = "mesa"
PREFERRED_PROVIDER_virtual/egl = "mesa"
PREFERRED_PROVIDER_virtual/mesa = "mesa"
11. cd ..
12. bitbake comodoo-image-firefox

The first image generated with this procedure might not work. In some
cases, after transferring the image to the SD card, inserting it in the raspberrypi
and powering it up, when we connect the ethernet cable to the port, the LEDs
in it do not light. Without a connection, there is not much we can do with the
raspberrypi. My recomendation in this case is:

1. cd /path/to/yocto/build
2. rm -fr tmp/
3. bitbake comodoo-image-firefox

This time, the building process will be a lot faster and the new image generated
in /path/to/yocto/build/tmp/deploy/images/raspberrypi3/ should be ok.


II. Build Configuration for RaspberryPi 3
=================================================

BB_VERSION        = "1.30.0"
BUILD_SYS         = "x86_64-linux"
NATIVELSBSTRING   = "universal"
TARGET_SYS        = "arm-poky-linux-gnueabi"
MACHINE           = "raspberrypi3"
DISTRO            = "poky"
DISTRO_VERSION    = "2.1.1"
TUNE_FEATURES     = "arm armv7ve vfp thumb neon vfpv4 callconvention-hard cortexa7"
TARGET_FPU        = "hard"
meta              
meta-poky         
meta-yocto-bsp    = "krogoth:8c69f7d56cbd496aa01ba0738675a170826a536b"
meta-raspberrypi  = "master:cc64d6324d1543f009f0c010d720e74b7cb9f5d5"
meta-oe           
meta-gnome        = "krogoth:895b25b387cae428c38990f4d2747603ee9dc92d"
meta-browser      = "firefox-45.0esr:14199ac070905b101e7bb0919748986c33374649"
meta-comodoo      = "krogoth-firefox:e397aee7136f2d77392e321a65513ca53903ba64"


III. Framebuffer in RaspberryPi
=================================================

Also, notice the file
/path/to/yocto/meta-comodoo/recipes-bsp/bootfiles/rpi-config_git.bbappend.
This file point to the a located in
git://github.com/indisoluble/RPi-config.git and its only purpose is to
force the screen size to 1024x768, which is quite convenient when we
connect with a VNC client to the RaspberryPi but there is not a display
plugged in the HDMI port.
